<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="potomax">
<title>R Package potomax: Overview • potomax</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="R Package potomax: Overview">
<meta property="og:description" content="potomax">
<meta property="og:image" content="https://irsn.github.io/potomax/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">potomax</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Intro.html">R Package potomax: Overview</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/IRSN/potomax/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>R Package potomax: Overview</h1>
                        <h4 data-toc-skip class="author">Yves
Deville</h4>
            
            <h4 data-toc-skip class="date">2024-01-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/IRSN/potomax/blob/HEAD/vignettes/Intro.Rmd" class="external-link"><code>vignettes/Intro.Rmd</code></a></small>
      <div class="d-none name"><code>Intro.Rmd</code></div>
    </div>

    
    
<p>This vignette has been compiled with R version 4.3.2 (2023-10-31)
using <strong>potomax</strong> 0.2.4.</p>
<div class="section level2">
<h2 id="the-potomax-package">The <strong>potomax</strong> package<a class="anchor" aria-label="anchor" href="#the-potomax-package"></a>
</h2>
<div class="section level3">
<h3 id="scope">Scope<a class="anchor" aria-label="anchor" href="#scope"></a>
</h3>
<p>The <strong>potomax</strong> package has been financed by IRSN/Behrig
and designed in response to some of Behrig’s practical needs for
Extreme-Value modelling.</p>
<p>The <strong>potomax</strong> package is devoted to the estimation and
inference of the <em>Poisson-GP</em> model in Extreme-Value Analysis.
The model is a marked Poisson process indexed by time with the marks
distributed according to the Generalised Pareto (GP) distribution. This
is a classical framework for Peaks Over Threshold (POT) modelling <span class="citation">(Davison and Smith 1990)</span>, although the
Binomial-GP can also be used.</p>
<p>By aggregating the marks in time and retaining the maxima or the
largest observations over given time intervals or time <em>blocks</em>,
we get the classical block maxima and <span class="math inline">\(r\)</span>-largest observations. As one of the
original features of the package, one can censor block maxima or <span class="math inline">\(r\)</span>-largest observations to discard
non-extreme block maxima.</p>
</div>
<div class="section level3">
<h3 id="similarities-and-differences-with-renext">Similarities and differences with <strong>Renext</strong><a class="anchor" aria-label="anchor" href="#similarities-and-differences-with-renext"></a>
</h3>
<p>As is the case with the formerly released package
<strong>Renext</strong> <span class="citation">(Deville and IRSN
2022)</span>, the package <strong>potomax</strong> allows the use of
observations that are aggregated in time. These involve standard block
maxima, but also <em>historical information</em>.</p>
<p><strong>potomax</strong> has several major differences with
<strong>Renext</strong>, which motivated the creation of a new
package</p>
<ul>
<li><p><em>Profile likelihood inference</em> <span class="citation">(Davison 2003)</span> can be used for the parameters
and for the return levels.</p></li>
<li><p><em>Only the GP distribution can be used</em> for the marks or
excesses. Since the GP distribution is the only distribution which can
be called <em>POT-stable</em>, the limitation to the GP is harmless as
far as the interest is on Extreme-Value analysis.</p></li>
<li><p>Most graphics are based on the <strong>ggplot2</strong> package
<span class="citation">(Wickham 2016)</span>, and the
<code>autoplot</code> method will be used instead of the
<code>plot</code> method.</p></li>
</ul>
<p>There are also differences plotting positions which will be briefly
discussed below.</p>
</div>
<div class="section level3">
<h3 id="model-and-parameters">Model and parameters<a class="anchor" aria-label="anchor" href="#model-and-parameters"></a>
</h3>
<p>The Poisson-GP model describes observations of random marks <span class="math inline">\(Y_i\)</span> at random times <span class="math inline">\(T_i\)</span> with the following assumptions.</p>
<ul>
<li><p>The events <span class="math inline">\(T_i\)</span> form a
Poisson Process with rate <span class="math inline">\(\lambda
&gt;0\)</span>.</p></li>
<li><p>The marks <span class="math inline">\(Y_i\)</span> are i.i.d.
with <span class="math inline">\(Y_i \sim \text{GPD}(u,\, \sigma, \,
\xi)\)</span>.</p></li>
<li><p>The marks <span class="math inline">\(Y_i\)</span> are
independent of the Poisson process of events.</p></li>
</ul>
<p>The number <span class="math inline">\(u\)</span> is regarded as
given and corresponds to the POT threshold. This model can be said to be
<em>POT-stable</em>, because if we select the exceedances <span class="math inline">\(Y_i&gt; u'\)</span> over a higher threshold
<span class="math inline">\(u' &gt; u\)</span>, the three
assumptions still hold for a different rate <span class="math inline">\(\lambda_{u'}\)</span> and a different GP scale
<span class="math inline">\(\sigma_{u'}\)</span>.</p>
<p>These assumptions allow the derivation of the marginal distribution
of so-called block maxima. Consider a time interval with duration <span class="math inline">\(w\)</span> and the maximum <span class="math inline">\(M := \max\{Y_i\}\)</span> of the marks <span class="math inline">\(Y_i\)</span> corresponding to the times <span class="math inline">\(T_i\)</span> in the interval. Then, up to an atom
corresponding to the case where no event occur in the interval, the
random variable <span class="math inline">\(M\)</span> follows a
Generalised Extreme Value (GEV) distribution. Moreover if we consider a
partition of the time axis into time intervals or time blocks <span class="math inline">\(b =1\)</span>, <span class="math inline">\(2\)</span>, <span class="math inline">\(\dots\)</span> with the same duration <span class="math inline">\(w\)</span>, we get i.i.d. GEV random variables
<span class="math inline">\(M_b\)</span>.</p>
<p>The model involves a vector <span class="math inline">\(\boldsymbol{\theta}\)</span> of three
parameters.</p>
<ul>
<li><p>The <em>Poisson-GP</em> parameterisation uses: the <em>rate</em>
<span class="math inline">\(\lambda\)</span> for the time-indexed
Poisson process of events and the two parameters <em>scale</em> <span class="math inline">\(\sigma\)</span> and <em>shape</em> <span class="math inline">\(\xi\)</span> of the GP distribution of the
excesses <span class="math inline">\(Y_i -u\)</span> over the threshold
<span class="math inline">\(u\)</span>. Note that both <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\sigma\)</span> depends on the threshold <span class="math inline">\(u\)</span> and consequently could be denoted by
<span class="math inline">\(\lambda_u\)</span> and <span class="math inline">\(\sigma_u\)</span>.</p></li>
<li><p>The <em>Point Process</em> or <em>Non-Homogeneous Point
Process</em> (NHPP) parameterisation refers to a reference block
duration <span class="math inline">\(w\)</span> and the uses the three
parameters of the marginal GEV distribution for the maximum <span class="math inline">\(M\)</span> of the marks <span class="math inline">\(Y_i\)</span> on an interval with duration <span class="math inline">\(w\)</span>. These parameters are the
<em>location</em> <span class="math inline">\(\mu^\star\)</span>, the
<em>scale</em> <span class="math inline">\(\sigma^\star\)</span> and the
<em>shape</em> <span class="math inline">\(\xi^\star\)</span>. Since the
location and the scale depend on the reference duration <span class="math inline">\(w\)</span>, they could be denoted by <span class="math inline">\(\mu^\star_{w}\)</span> and <span class="math inline">\(\sigma^\star_{w}\)</span>.</p></li>
</ul>
<p>The shape parameter <span class="math inline">\(\xi\)</span> or <span class="math inline">\(\xi^\star\)</span> is the same in the two
parameterisations, and relates to the common tail-index of the two
distributions GP and GEV. This parameter characterises the common domain
of attraction of the distributions of the excesses and of the block
maxima.</p>
<p>The two POT parameterisations are used in several CRAN packages,
including: <strong>evd</strong> <span class="citation">(Stephenson
2002)</span>, <strong>ismev</strong> <span class="citation">(Heffernan
and Stephenson 2012)</span>, <strong>extRemes</strong> <span class="citation">(Gilleland and Katz 2016)</span>, <strong>POT</strong>
<span class="citation">(Ribatet and Dutang 2022)</span>. See also
Northrop et al. <span class="citation">(Northrop, Jonathan, and Randell
2016)</span> for a presentation of the two frameworks and their
differences in the non-stationary extension using covariates.</p>
<p><img src="images/TwoParameterisations.png" width="80%" style="display: block; margin: auto;"></p>
<p>The Poisson-GP parameterisation will often be preferred because it
can allow to concentrate the rate parameter out of the log-likelihood,
leading to a two-parameter optimisation instead of a three-parameter
one. This holds for the specific kinds of censoring allowed in the
package.</p>
<p>Note that in the Poisson-GP formulation we can use observations that
are exceedances over a threshold <span class="math inline">\(u'\)</span> and parameters related to another
“reference” threshold <span class="math inline">\(u\)</span>. This is
similar to the NHPP parameterisation where the classical one-year
reference block duration could be used with observations for two-year
blocks. So, the specific parameterisation does not impose the specific
censoring needed to elicit the observations that are extreme enough.
Many series of annual maxima embed observations that would not be judged
as extreme enough in the POT approach. Rather than aggregating then the
annual maxima into bi-annual maxima, we can simply use censoring, see
the Venice example below.</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-and-using-poisgp-objects">Creating and using <code>poisGP</code> objects<a class="anchor" aria-label="anchor" href="#creating-and-using-poisgp-objects"></a>
</h2>
<p>The main class in the package is <code>"PoisGP"</code>. The eponymous
creator uses a <code>data</code> formal argument which can be given a
simple numeric vector containing the marks <span class="math inline">\(Y_i\)</span>, or more complex data structures such
as <code>"Rendata"</code> from <strong>Renext</strong> or
<code>"potData"</code> from <strong>potomax</strong>, see below. We
begin by using the <code>Garonne</code> object from
<strong>Renext</strong>. This object contains observations for the
discharge rate of the river Garonne (France) in cumecs. It embeds both
“systematic” observations and “historical” observations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Garonne</span></span></code></pre></div>
<pre><code><span><span class="co">## o Dataset La Garonne river flow</span></span>
<span><span class="co">##    data 'Garonne', variable 'Flow' (m3/s) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## o OT data (main sample) from  1913-01-01  to  1978-01-01  (eff. dur.  65.00 years)</span></span>
<span><span class="co">##  </span></span>
<span><span class="co">##        n     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">##  151.000 2530.000 2900.000 3200.000 3591.675 3995.000 7500.000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## o no missing OT periods </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## o 'MAX' historical info: 1 blocks, 12 obs., total duration = 143.09 years </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## o no 'OTS' historical data</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitGaronne</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poisGP.html">poisGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Garonne</span>, threshold <span class="op">=</span> <span class="fl">2900</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fitGaronne</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "poisGP"</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"poisGP"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] AIC      autoplot BIC      coef     confint  logLik   MLE      print   </span></span>
<span><span class="co">##  [9] RL       summary  vcov    </span></span>
<span><span class="co">## see '?methods' for accessing help and source code</span></span></code></pre>
<p>The methods implemented are classical and can be used as in many
other packages. Note that the <code>plot</code> method does not exist,
and that <code>autoplot</code> should instead be used.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">fitGaronne</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/poisGP-Garonne-1.png" width="500px" style="display: block; margin: auto;"></p>
<p>Note that the 12 “historical” observations are plotted using a
different colour.</p>
<p>The classical <code>coef</code> method can be used to extract the
(estimated) parameters. It has an argument <code>type</code> allowing to
choose the parameterisation. The parameters are estimated in the
Poisson-GP parameterisation, and then translated into the NHPP
parameterisation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitGaronne</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       lambda        scale        shape </span></span>
<span><span class="co">##    1.7259695 1287.2134428   -0.1650405</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitGaronne</span>, type <span class="op">=</span> <span class="st">"PP"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          loc        scale        shape </span></span>
<span><span class="co">## 3571.8341138 1176.3335728   -0.1650405</span></span></code></pre>
<p>The shape parameter is the same in both parameterisations. However
the <code>scale</code> parameters differ.</p>
</div>
<div class="section level2">
<h2 id="profile-likelihood">Profile likelihood<a class="anchor" aria-label="anchor" href="#profile-likelihood"></a>
</h2>
<div class="section level3">
<h3 id="using-constrained-optimisations">Using constrained optimisations<a class="anchor" aria-label="anchor" href="#using-constrained-optimisations"></a>
</h3>
<p>Profile likelihood can be used to infer on the parameters, be they in
the Poisson-GP or in the NHPP parameterisation. As for the
<code>coef</code> method, the <code>confint</code> method has a
<code>type</code> argument allowing to switch from the default
parameterisation to the <code>"NHPP"</code> one. The cheap <em>delta
method</em> can also be used in place of profile likelihood if
needed.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fitGaronne</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## , , 95%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              L        U</span></span>
<span><span class="co">## lambda   1.432    2.057</span></span>
<span><span class="co">## scale  991.960 1620.818</span></span>
<span><span class="co">## shape   -0.300    0.005</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fitGaronne</span>, method <span class="op">=</span> <span class="st">"delta"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## , , 95%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              L        U</span></span>
<span><span class="co">## lambda   1.413    2.039</span></span>
<span><span class="co">## scale  971.417 1603.010</span></span>
<span><span class="co">## shape   -0.316   -0.014</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fitGaronne</span>, type <span class="op">=</span> <span class="st">"PP"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## , , 95%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              L        U</span></span>
<span><span class="co">## loc   3333.326 3824.637</span></span>
<span><span class="co">## scale  977.466 1405.775</span></span>
<span><span class="co">## shape   -0.300    0.005</span></span></code></pre>
<p>Profile likelihood can also be used to infer on the return levels as
returned by the <code>RL</code> method.</p>
<p>As in the <strong>NSGEV</strong> package, the profile likelihood
confidence intervals for the parameters are in <strong>potomax</strong>
computed by using constrained optimisations. Roughly speaking, we
maximise and minimise the parameter under the constraint that the
log-likelihood is high enough. More precisely, if <span class="math inline">\(\eta = \eta(\boldsymbol{\theta})\)</span> is a
scalar parameter of interest, we can find the upper bound <span class="math inline">\(\eta_{\text{U}}\)</span> of a confidence interval
on it by maximising the parameter <span class="math inline">\(\eta\)</span> under the constraint <span class="math inline">\(\ell(\boldsymbol{\theta}) \geqslant
\ell_{\text{max}} - \delta\)</span>, where <span class="math inline">\(\ell(\boldsymbol{\theta})\)</span> is the
log-likelihood function and <span class="math inline">\(\ell_{\text{max}}\)</span> is its maximal value.
The (positive) quantity <span class="math inline">\(\delta\)</span>
relates to the chi-square distribution with one degree of freedom
according to <span class="math inline">\(\delta = q_{\chi^2(1)}(1 -
\alpha) / 2\)</span>, where <span class="math inline">\(1 -
\alpha\)</span> is the chosen confidence level. Similarly, the lower
bound of the interval by minimising <span class="math inline">\(\eta\)</span> under the same constraint.</p>
<p>Remind that the classical method used for profile likelihood consists
in computing the profile log-likelihood function <span class="math inline">\(\ell_{\text{prof}}(\eta)\)</span> and in solving
numerically the equation <span class="math inline">\(\ell_{\text{prof}}(\eta) = \ell_{\text{max}} -
\delta\)</span>. Provided that the log-likelihood function is
well-shaped, two solutions exist: one on each side of the ML estimate
<span class="math inline">\(\widehat{\eta}\)</span>. These are the lower
and upper bounds of the confidence interval <span class="math inline">\((\eta_{\text{L}}, \, \eta_{\text{U}})\)</span>.
Each evaluation of the profile log-likelihood requires an optimisation
on <span class="math inline">\(2\)</span> parameters, and moreover we
have to solve the two equations by using either a zero-finding method or
a search on a grid of candidate values for <span class="math inline">\(\eta\)</span>.</p>
</div>
<div class="section level3">
<h3 id="checking-the-results">Checking the results<a class="anchor" aria-label="anchor" href="#checking-the-results"></a>
</h3>
<p>The constrained optimisation method is appealing for its generality.
However, the optimisation can fail and misleadingly indicate a
convergence, which can be quite difficult to diagnose. The classical
approach solving equations for the profile log-likelihood may also fail,
yet the results can be checked by plotting the the negative profile
likelihood <span class="math inline">\(-\ell_{\text{prof}}(\eta)\)</span> against the
parameter <span class="math inline">\(\eta\)</span>, which should lead
to a smooth curve with a minimum at the ML estimate <span class="math inline">\(\widehat{\eta}\)</span>. By adding the horizontal
line corresponding to the negative log-likelihood ordinate <span class="math inline">\(-(\ell_{\max} - \delta)\)</span>, the confidence
bounds <span class="math inline">\(\eta_{\text{L}}\)</span> and <span class="math inline">\(\eta_{\text{U}}\)</span> should be the abscissas
of the two intersection points between the curve and the horizontal
line. This approach is used by several R packages including
<strong>ismev</strong>, <strong>evd</strong>, <strong>extRemes</strong>
and <strong>POT</strong>. This check has been implemented in
<strong>potomax</strong> as well.</p>
<p>Both the <code>RL</code> and the <code>confint</code> methods have an
argument <code>check</code> taking a logical value. Using
<code>check = TRUE</code> will produce a plot visual check as shown
below. On the curves in black, each bullet required an evaluation of the
profile log-likelihood, hence a two-parameter optimisation. It may
happen that the optimisation fails, leading to a <code>NA</code>. This
happens quite often for the small (negative) values of the shape
parameter <span class="math inline">\(\xi\)</span> or for the small
values of the return levels corresponding to a small return period, say
<span class="math inline">\(T &lt; 10\)</span> years.</p>
<p>If the results are good, then we can re-run with the (default)
<code>check = FALSE</code> to get the results involving confidence
intervals.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fitGaronne</span>, check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Rgraphics/checkCI-1.png" alt="Checking the results of `confint`. The red vertical lines show the bounds. The negative log-likelihood curve and the horizontal red line should intersect at the bounds." width="500px"><p class="caption">
Checking the results of <code>confint</code>. The red vertical lines
show the bounds. The negative log-likelihood curve and the horizontal
red line should intersect at the bounds.
</p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="fu"><a href="../reference/RL.html">RL</a></span><span class="op">(</span><span class="va">fitGaronne</span>, check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Rgraphics/checkRL-1.png" alt="Checking the confidence intervals of `RL`. The red vertical lines show the bounds." width="800px"><p class="caption">
Checking the confidence intervals of <code>RL</code>. The red vertical
lines show the bounds.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="heterogeneous-data">Heterogeneous data<a class="anchor" aria-label="anchor" href="#heterogeneous-data"></a>
</h2>
<div class="section level3">
<h3 id="different-kinds-of-observations">Different kinds of observations<a class="anchor" aria-label="anchor" href="#different-kinds-of-observations"></a>
</h3>
<p>In the simplest use, the formal argument <code>data</code> is a
numeric vector giving the marks <span class="math inline">\(Y_i\)</span>. Then one must also use the formal
argument <code>effDuration</code> to give the so-called
<em>effective</em> duration which can take into account possible gaps in
the data. In this case the estimate of the rate <span class="math inline">\(\lambda_u\)</span> for a given threshold <span class="math inline">\(u\)</span> is simply number of <span class="math inline">\(Y_i\)</span> with <span class="math inline">\(Y_i
&gt; u\)</span>, divided by the effective duration.</p>
<p>The two optional arguments <code>MAX.data</code> and
<code>OTS.data</code> can be used to describe observations that have
been censored: <em>by value</em> (Type I) or <em>by number</em> (Type
II). In both cases, the observations are given as a <em>list</em> which
must be completed by a numeric vector of durations,
<code>MAX.effDuration</code> or <code>OTS.effDuration</code>. Each
element of the “data” list corresponds to an interval of time and
contains a vector with either the largest observations (for
<code>MAX.data</code>) or all the observations that exceeded a specific
threshold (for <code>OTS.data</code>). The list must have the same
length as the numeric vector of durations, each element relating to a
period of time. In the “OTS” case, one must also give a numeric vector
of thresholds <code>OTS.threshold</code>.</p>
<p>Note that <code>MAX.data</code> can be used for the classical block
maxima and the <span class="math inline">\(r\)</span>-largest
observations.</p>
<p>Both for MAX and OTS data it is a good practice to use <em>named</em>
lists, in order to keep a trace of the period. For instance the names
can be the years for block maxima or for <span class="math inline">\(r\)</span>-largest observations. The same vector
of element names should then be used for the data lists, the vector of
durations and the vector thresholds in the “OTS” case.</p>
<p>Finally, rather than using several arguments we can use a single
structure describing the heterogeneous data. For this aim the function
<code>potData</code> can be used to create an object of class
<code>"potData"</code>. Such an object can be passed to the
<code>data</code> argument of <code>poisGP</code> an be re-used if
different fits are a.g., with different thresholds.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">G</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/potData.html">potData</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Flow</span>,</span>
<span>             effDuration <span class="op">=</span> <span class="fl">65</span>,</span>
<span>             MAX.data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">MAXdata</span><span class="op">$</span><span class="va">Flow</span>,</span>
<span>             MAX.effDuration <span class="op">=</span> <span class="fl">143</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">G</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 3</span></span>
<span><span class="co">##  $ OT :List of 4</span></span>
<span><span class="co">##   ..$ flag       : logi TRUE</span></span>
<span><span class="co">##   ..$ effDuration: num 65</span></span>
<span><span class="co">##   ..$ n          : int 151</span></span>
<span><span class="co">##   ..$ data       : num [1:151] 2600 2800 2700 4579 3400 ...</span></span>
<span><span class="co">##  $ MAX:List of 4</span></span>
<span><span class="co">##   ..$ flag       : logi TRUE</span></span>
<span><span class="co">##   ..$ effDuration: num 143</span></span>
<span><span class="co">##   ..$ r          : int 12</span></span>
<span><span class="co">##   ..$ data       :List of 1</span></span>
<span><span class="co">##   .. ..$ MAX block#1: num [1:12] 7500 7400 7000 7000 7000 6600 6500 6500 6400 6300 ...</span></span>
<span><span class="co">##  $ OTS:List of 5</span></span>
<span><span class="co">##   ..$ flag       : logi FALSE</span></span>
<span><span class="co">##   ..$ effDuration: logi NA</span></span>
<span><span class="co">##   ..$ r          : logi NA</span></span>
<span><span class="co">##   ..$ threshold  : NULL</span></span>
<span><span class="co">##   ..$ data       : NULL</span></span>
<span><span class="co">##  - attr(*, "class")= chr "potData"</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">G</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Garonne: raw observations"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/potData-1.png" width="600px" style="display: block; margin: auto;"></p>
<p>The <code>potData</code> structure encapsulates several possible
arguments of <code>PoisGP</code> in a single object. This is similar to
what is done for the classical <code>plot</code> method: its argument
<code>x</code> can be either a vector or a list with elements
<code>x</code> and <code>y</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="fu"><a href="../reference/poisGP.html">poisGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">G</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Garonne: fit with default threshold"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in poisGP(data = G): 'threshold' is missing and set just below the</span></span>
<span><span class="co">## smallest obsevation</span></span></code></pre>
<pre><code><span><span class="co">## Warning in threshData(threshold = threshold, data, exceed = TRUE, scale =</span></span>
<span><span class="co">## scale, : 'threshold' is smaller than the smallest observation</span></span></code></pre>
<pre><code><span><span class="co">## Warning in threshData(data, threshold = threshold, exceed = FALSE, scale =</span></span>
<span><span class="co">## FALSE): 'threshold' is smaller than the smallest observation</span></span></code></pre>
<p><img src="Rgraphics/potData1-1.png" width="600px" style="display: block; margin: auto;"></p>
<p>Note that when a <code>potData</code> object is used as the
<code>data</code> argument with no threshold, a default threshold is
used. It is chosen just below the smallest observation in the data,
including those in <code>data</code>, <code>MAX.data</code> and
<code>OTS.data</code>, if any. When this rule is applied with only
<code>MAX.data</code> and when all the elements in
<code>MAX.effDuration</code> are identical, the fitted object is
compliant with the usual block maxima estimation: the estimated
parameters in the <code>PP</code> parameterisation are those returned by
classical functions for the estimation of GEV parameters such as
<code>ismev::dev.fit</code> or <code>evd:fgev</code>. Remind however
that <code>MAX.data</code> must be a <em>list</em>, not an atomic
vector, and that the durations must be given.</p>
</div>
<div class="section level3">
<h3 id="r-largest-example-venice-data">
<span class="math inline">\(r\)</span>-largest example: Venice
data<a class="anchor" aria-label="anchor" href="#r-largest-example-venice-data"></a>
</h3>
<p>We now use the Venice data from the <strong>ismev</strong> package,
see section <strong>3.5</strong> in Coles’ book <span class="citation">(Coles 2001)</span>. The data contain the <span class="math inline">\(r\)</span>-largest annual observations of the sea
level in Venice. The data come as a matrix with one row by year
containing the <span class="math inline">\(10\)</span> largest water
levels (in cm), possibly <code>NA</code>. Some transformations are
needed to use the <code>poisGP</code> function. Note that the first
column of <code>venice</code> must be removed from the data since its
contains the year.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">venice</span>, package <span class="op">=</span> <span class="st">"ismev"</span><span class="op">)</span></span>
<span><span class="va">yNms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">venice</span><span class="op">[</span> , <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">MAX.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">venice</span><span class="op">[</span> , <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">MAX.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MAX.data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">MAX.effDuration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">MAX.data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">MAX.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">MAX.effDuration</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">yNms</span></span>
<span><span class="co">## fir r-largest models</span></span>
<span><span class="va">fit2i</span> <span class="op">&lt;-</span> <span class="fu">ismev</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ismev/man/rlarg.fit.html" class="external-link">rlarg.fit</a></span><span class="op">(</span><span class="va">venice</span><span class="op">[</span> , <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, show <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">fit2R</span> <span class="op">&lt;-</span> <span class="fu">Renext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Renext/man/fGEV.MAX.html" class="external-link">fGEV.MAX</a></span><span class="op">(</span>MAX.data <span class="op">=</span> <span class="va">MAX.data</span>, MAX.effDuration <span class="op">=</span> <span class="va">MAX.effDuration</span><span class="op">)</span></span>
<span><span class="va">fit2p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poisGP.html">poisGP</a></span><span class="op">(</span>MAX.data <span class="op">=</span> <span class="va">MAX.data</span>, MAX.effDuration <span class="op">=</span> <span class="va">MAX.effDuration</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in threshData(threshold = threshold, data, exceed = TRUE, scale =</span></span>
<span><span class="co">## scale, : 'threshold' is smaller than the smallest observation</span></span></code></pre>
<pre><code><span><span class="co">## Warning in threshData(data, threshold = threshold, exceed = FALSE, scale =</span></span>
<span><span class="co">## FALSE): 'threshold' is smaller than the smallest observation</span></span></code></pre>
<p>Both <strong>Renext</strong> and <strong>potomax</strong> throw
warnings because they have to set the missing threshold just below the
smallest observations in order to stick to the Poisson-GP
parameterisation. In a classical POT, it is unnatural that all
observations are exceedances.</p>
<p>In order to compare the coefficients across packages, we must use the
<code>"PP"</code> coefficients of the <code>poisGP</code> object rather
than the standard <code>"poisGP"</code> coefficients.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"ismev"</span> <span class="op">=</span> <span class="va">fit2i</span><span class="op">$</span><span class="va">mle</span>,</span>
<span>      <span class="st">"Renext"</span> <span class="op">=</span> <span class="va">fit2R</span><span class="op">$</span><span class="va">estimate</span>,</span>
<span>      <span class="st">"potomax"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit2p</span>, type <span class="op">=</span> <span class="st">"PP"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             ismev      Renext     potomax</span></span>
<span><span class="co">## loc   120.5479027 120.5452617 120.5459990</span></span>
<span><span class="co">## scale  12.7840265  12.7831983  12.7838900</span></span>
<span><span class="co">## shape  -0.1129418  -0.1129793  -0.1129545</span></span></code></pre>
<p><strong>Caution</strong> When comparing log-likelihoods across
packages, some difference may be due to the use of different constants,
see <code><a href="../reference/logLik.poisGP.html">?logLik.poisGP</a></code>. We choose here the <code>"PP"</code>
type log-likelihood which usually makes the results comparable to those
based on block maxima or on <span class="math inline">\(r\)</span>-largest.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"ismev"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fit2i</span><span class="op">$</span><span class="va">nllh</span>,</span>
<span>      <span class="st">"Renext"</span> <span class="op">=</span> <span class="va">fit2R</span><span class="op">$</span><span class="va">loglik</span>,</span>
<span>      <span class="st">"potomax"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit2p</span>, type <span class="op">=</span> <span class="st">"PP"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         ismev   Renext  potomax</span></span>
<span><span class="co">## [1,] -1139.09 -1139.09 -1139.09</span></span></code></pre>
<p>Now profile likelihood confidence intervals on parameters</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit2p</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## , , 95%</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             L      U</span></span>
<span><span class="co">## lambda 24.749 31.087</span></span>
<span><span class="co">## scale  16.838 20.439</span></span>
<span><span class="co">## shape  -0.133 -0.067</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">fit2p</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Venice r-largest, no threshold"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/Venice3-1.png" width="600px" style="display: block; margin: auto;"></p>
<p>As written by Coles, <em>“the plots again indicate a fundamental lack
of fit for the model”</em>. Note that the smallest observations indicate
a neat concave curvature, while the largest ones seem to better conform
to an exponential tail. We can further investigate this by censoring the
the MAX data, on the basis of the Poisson-GP model. We here choose a
threshold of <span class="math inline">\(110\)</span> cm corresponding
to <a href="https://en.wikipedia.org/wiki/Acqua_alta" class="external-link">”very intense”
aqua alta</a>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit3p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poisGP.html">poisGP</a></span><span class="op">(</span>MAX.data <span class="op">=</span> <span class="va">MAX.data</span>, MAX.effDuration <span class="op">=</span> <span class="va">MAX.effDuration</span>, threshold <span class="op">=</span> <span class="fl">110</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit3p</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       lambda        scale        shape </span></span>
<span><span class="co">##  1.730358874 12.916670381 -0.004969052</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">fit3p</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Venice r-largest with threshold 110 cm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/Venice4-1.png" width="600px" style="display: block; margin: auto;"></p>
<p>The fit is now quite good. We have years with no observations and
years with <span class="math inline">\(5\)</span> observations or more,
which is a departure from the Poisson hypothesis often met in POT.</p>
<p>When using a threshold with <code>MAX.data</code>, it may happen that
for a given block (here one year) some observations are under the
threshold, hence have to be discarded. In this case, the block is
considered as <code>OTS.data</code>. This works even when the block no
longer contains any observation and is the correct way to encode the
information in the censoring. This quite subtle point explains why a
different colour and shape (green diamond) is now used for the
corresponding blocks: “MAX” blocks were turned into “OTS” blocks. Note
that provided that a MAX block has at least an observation, its
log-likelihood is the same as that of an OTS block with its threshold
set to the smallest observations in the block.</p>
</div>
<div class="section level3">
<h3 id="plotting-positions">Plotting positions<a class="anchor" aria-label="anchor" href="#plotting-positions"></a>
</h3>
<p><strong>potomax</strong> favours the log-scale axis for the durations
in RL plots, as opposed to the Gumbel scale. This allows to
straightforwardly show the marks <span class="math inline">\(Y_i\)</span>. But block maxima can be shown on the
same plot by using suitable plotting positions <span class="citation">(Deville 2016)</span>. These positions are designed to
get points around a common straight line in the exponential-Gumbel case
<span class="math inline">\(\xi = 0\)</span>, both for the marks and the
maxima.</p>
<p>The plotting positions are derived from Nelson’s plotting positions,
taking into account censoring when needed, then using the method of
Hirsh and Stedinger. For the marks, the resulting positions are very
close to those computed with the <code>ppoints</code> function with its
default arguments, as used in most R packages. They differ from the
so-called <em>Weibull positions</em> used in <strong>Renext</strong>. As
a consequence, the largest observations seem to be related to larger
return periods when compared to <strong>Renext</strong>. Mind however
that attaching a return period to the largest observations is prone to
misinterpretation. See the help of the <code>RP</code> method and
references/links therein for details on the plotting positions.</p>
</div>
</div>
<div class="section level2">
<h2 id="special-gp-distribution-for-the-excesses">Special GP distribution for the excesses<a class="anchor" aria-label="anchor" href="#special-gp-distribution-for-the-excesses"></a>
</h2>
<div class="section level3">
<h3 id="exponential-gumbel-case">Exponential-Gumbel case<a class="anchor" aria-label="anchor" href="#exponential-gumbel-case"></a>
</h3>
<p>From version 0.2.0, it is possible to use the exponential
distribution as the distribution of the excesses <span class="math inline">\(Y_i -u\)</span>, implying Gumbel maxima <span class="math inline">\(M\)</span> over time intervals. This is simply
achieved by using the formal argument <code>distName</code> with the
value <code>"exp1"</code>, the default GPD corresponding to
<code>"GPD2"</code>. In this case the vector of parameters is <span class="math inline">\([\lambda, \, \sigma]\)</span> (<code>rate</code>
and <code>scale</code>) for the Poisson-GP parameterisation, and <span class="math inline">\([\mu^\star,\, \sigma^\star]\)</span>
(<code>loc</code> and <code>scale</code>) for the NHPP parameterisation.
The inference on the parameters is similar to that of the standard case
of GPD exceedances.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitGaronneExp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poisGP.html">poisGP</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Garonne</span>, threshold <span class="op">=</span> <span class="fl">3200</span>, distName <span class="op">=</span> <span class="st">"exp1"</span><span class="op">)</span></span>
<span><span class="fu">autoplot</span><span class="op">(</span><span class="va">fitGaronneExp</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Garonne with exponential excesses"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/garonneExp-1.png" width="500px" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fitGaronneExp</span>, check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Rgraphics/garonneExp1-1.png" width="500px" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="constraints-on-parameters">Constraints on parameters<a class="anchor" aria-label="anchor" href="#constraints-on-parameters"></a>
</h3>
<p>The <code>poisGP</code> creator function has two arguments
<code>coefLower</code> and <code>coefUpper</code> that can be used to
set bounds on the parameters. These are used only when
<code>estim</code> is set to <code>"nloptr"</code>. The bounds can be
infinite <code>Inf</code> or <code>-Inf</code>. Moreover if the lower
and the upper bounds for one parameter are identical, then the parameter
will be fixed. As a rule, the inference will be misleading when
inequality bounds are given. For instance, setting the bound <span class="math inline">\(\xi \geqslant 0\)</span> corresponds to using the
Lomax distribution for the excesses but with a possible ML estimate
<span class="math inline">\(\widehat{\xi} = 0\)</span> on the boundary.
The confidence intervals will generally be misleading when constraints
are used.</p>
</div>
</div>
<div class="section level2">
<h2 id="notes-and-issues">Notes and issues<a class="anchor" aria-label="anchor" href="#notes-and-issues"></a>
</h2>
<div class="section level3">
<h3 id="return-levels">Return levels<a class="anchor" aria-label="anchor" href="#return-levels"></a>
</h3>
<p>The return level for a period <span class="math inline">\(T\)</span>
can equivalently be considered as a function <span class="math inline">\(\rho(T;\,\boldsymbol{\theta})\)</span> of the
Poisson parameter <span class="math inline">\(\boldsymbol{\theta}\)</span> or as a function
<span class="math inline">\(\rho^\star(T;\,
\boldsymbol{\theta}^\star)\)</span> of the PP parameter <span class="math inline">\(\boldsymbol{\theta}^\star\)</span>. The two
functions take the same value when <span class="math inline">\(\boldsymbol{\theta}\)</span> and <span class="math inline">\(\boldsymbol{\theta}^\star\)</span> describe the
same model. For <span class="math inline">\(\xi \neq 0\)</span> these
are <span class="math display">\[
\underset{\rho(T;\,\boldsymbol{\theta})}{\underbrace{%
u + \sigma_u \, \frac{[\lambda_u T]^\xi - 1}{\xi}}} =
\underset{\rho^\star(T;\,\boldsymbol{\theta}^\star)}{\underbrace{%
\mu^\star_w + \sigma^\star_w \frac{[T /w]^{\xi^\star} - 1}{\xi^\star}}},
\]</span></p>
<p>and for <span class="math inline">\(\xi = 0\)</span> we can use the
log limit of the Box-Cox transformation. Note that <span class="math inline">\(\rho^\star(T)\)</span> given above is the
<em>continuous duration</em> return level, which for <span class="math inline">\(T\)</span> small differs from the <em>block
duration</em> return level} that is associated to the number <span class="math inline">\(T/w\)</span> of blocks with duration <span class="math inline">\(w\)</span>. To get the classical return level for
block maxima, replace <span class="math inline">\(q := w /T\)</span> by
<span class="math inline">\(1 - \log(1 - q)\)</span>, nearly the same
thing for small <span class="math inline">\(q\)</span>, say <span class="math inline">\(q &lt; 1/50\)</span>.</p>
</div>
<div class="section level3">
<h3 id="log-likelihood-aic-and-bic">Log-likelihood, AIC and BIC<a class="anchor" aria-label="anchor" href="#log-likelihood-aic-and-bic"></a>
</h3>
<p>The log-likelihood is defined up to an additive constant. Most R
packages use two different constants: one for block maxima, one for POT
without caring about consistency. For example using
<code><a href="https://rdrr.io/pkg/evd/man/fpot.html" class="external-link">evd::fpot</a></code> with the same data and the two choices
<code>model = "pp"</code> and <code>model = "gpd"</code> we get two
estimates which are consistent up to the re-parameterisation, but yet
have different log-likelihoods. So it may be difficult to compare the
log-likelihoods across packages or even within a package.</p>
<p>In the general framework considered in <strong>potomax</strong>, the
concept of <em>number of observations</em> is unclear, hence so are AIC
and BIC. The concept of number of observations makes sense when the
observations have the same marginal distribution and are independent and
identically distributed, or correspond to a form of stationarity. But in
the framework of <strong>potomax</strong>, one observation for a
widespread time interval may be more informative than several
observations corresponding to events or smaller time intervals.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Coles_ISMEV" class="csl-entry">
Coles, Suart. 2001. <em><span class="nocase">An Introduction to
Statistical Modelling of Extreme Values</span></em>. Springer. <a href="https://doi.org/10.1007/978-1-4471-3675-0" class="external-link">https://doi.org/10.1007/978-1-4471-3675-0</a>.
</div>
<div id="ref-Davison_StatModels" class="csl-entry">
Davison, Anthony C. 2003. <em><span>Statistical Models</span></em>.
Cambridge Series on Statistical and Probabilistic Mathematics. Cambridge
University Press. <a href="https://doi.org/10.1017/CBO9780511815850" class="external-link">https://doi.org/10.1017/CBO9780511815850</a>.
</div>
<div id="ref-DavisonSmith_POT" class="csl-entry">
Davison, Anthony C., and Richard L. Smith. 1990. <span>“<span class="nocase">Models for Exceedances over High
Thresholds</span>.”</span> <em><span>J.R. Statist. Soc. B</span></em> 52
(3): 393–442. <a href="https://doi.org/10.1111/j.2517-6161.1990.tb01796.x" class="external-link">https://doi.org/10.1111/j.2517-6161.1990.tb01796.x</a>.
</div>
<div id="ref-Deville_Renext" class="csl-entry">
Deville, Yves. 2016. <span>“<span>Renext Computing
Details</span>.”</span> <span>Technical Report</span>. <a href="https://github.com/IRSN/Renext" class="external-link">https://github.com/IRSN/Renext</a>.
</div>
<div id="ref-Pack_Renext" class="csl-entry">
Deville, Yves, and IRSN. 2022. <em><span class="nocase">Renext: Renewal
Method for Extreme Values Extrapolation</span></em>.
</div>
<div id="ref-PACKextRemes" class="csl-entry">
Gilleland, Eric, and Richard W. Katz. 2016. <span>“<span class="nocase">extRemes 2.0: An Extreme Value Analysis Package in
R</span>.”</span> <em>Journal of Statistical Software</em> 72 (8): 1–39.
<a href="https://doi.org/10.18637/jss.v072.i08" class="external-link">https://doi.org/10.18637/jss.v072.i08</a>.
</div>
<div id="ref-PACKismev" class="csl-entry">
Heffernan, Janet E., and Alec G. Stephenson. 2012. <em><span class="nocase">ismev: An Introduction to Statistical Modeling of Extreme
Values</span></em>. <a href="https://CRAN.R-project.org/package=ismev" class="external-link">https://CRAN.R-project.org/package=ismev</a>.
</div>
<div id="ref-NorthropEtAl_NSExtremes" class="csl-entry">
Northrop, Paul J., Phillip Jonathan, and David Randell. 2016.
<span>“<span class="nocase">Threshold Modelling of Non-Stationary
Extremes</span>.”</span> In <em><span class="nocase">Extreme Value
Modeling and Risk Analysis</span></em>, edited by Dey, Dipak K. and Yan,
Jun. <span>Chapman &amp; Hall</span>. <a href="https://doi.org/10.1201/b19721" class="external-link">https://doi.org/10.1201/b19721</a>.
</div>
<div id="ref-PACKPOT" class="csl-entry">
Ribatet, Mathieu, and Christophe Dutang. 2022. <em><span class="nocase">POT: Generalized Pareto Distribution and Peaks Over
Threshold</span></em>. <a href="https://CRAN.R-project.org/package=POT" class="external-link">https://CRAN.R-project.org/package=POT</a>.
</div>
<div id="ref-PACKevd" class="csl-entry">
Stephenson, Alec G. 2002. <span>“<span class="nocase">evd: Extreme Value
Distributions</span>.”</span> <em>R News</em> 2 (2): 0. <a href="https://cran.r-project.org/doc/Rnews/" class="external-link">https://cran.r-project.org/doc/Rnews/</a>.
</div>
<div id="ref-Pack_ggplot2" class="csl-entry">
Wickham, Hadley. 2016. <em><span class="nocase"><span class="nocase">ggplot2</span>: Elegant Graphics for Data
Analysis</span></em>. Springer-Verlag New York. <a href="https://doi.org/10.1007/978-0-387-98141-3" class="external-link">https://doi.org/10.1007/978-0-387-98141-3</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Yves Deville.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
