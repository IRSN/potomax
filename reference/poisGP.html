<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Create a Poisson-GP model object, usually by ML estimation."><title>Create a Poisson-GP Model Object — poisGP • potomax</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a Poisson-GP Model Object — poisGP"><meta property="og:description" content="Create a Poisson-GP model object, usually by ML estimation."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">potomax</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Intro.html">R Package potomax: Overview</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/IRSN/potomax/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create a Poisson-GP Model Object</h1>
      <small class="dont-index">Source: <a href="https://github.com/IRSN/potomax/blob/HEAD/R/poisGP.R" class="external-link"><code>R/poisGP.R</code></a></small>
      <div class="d-none name"><code>poisGP.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a Poisson-GP model object, usually by ML estimation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">poisGP</span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">threshold</span>, <span class="va">effDuration</span>,</span>
<span>       MAX.data <span class="op">=</span> <span class="cn">NULL</span>, MAX.effDuration <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       OTS.data <span class="op">=</span> <span class="cn">NULL</span>, OTS.threshold <span class="op">=</span> <span class="cn">NULL</span>, OTS.effDuration <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       distName <span class="op">=</span> <span class="st">"GPD2"</span>,</span>
<span>       parIni <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       estim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"optim"</span>, <span class="st">"nloptr"</span>, <span class="st">"eval"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>       coefLower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda"</span> <span class="op">=</span> <span class="fl">0.0</span>, <span class="st">"scale"</span> <span class="op">=</span> <span class="fl">0.0</span>, <span class="st">"shape"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.90</span><span class="op">)</span>,</span>
<span>       coefUpper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda"</span> <span class="op">=</span> <span class="cn">Inf</span>, <span class="st">"scale"</span> <span class="op">=</span> <span class="cn">Inf</span>, <span class="st">"shape"</span> <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>       scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>Either a vector containing the observations for the
"main" sample or an object describing heterogeneous data. In
the second case, <code>data</code> can be of class <code>"potData"</code>
(see <code><a href="potData.html">potData</a></code>) or of class <code>"Rendata"</code> from
the <strong>Renext</strong> package. Mind that the class
<code>"Rendata"</code> does not yet have a creator, but random
<code>Rendata</code> objects can be created for testing by using
<code><a href="https://rdrr.io/pkg/Renext/man/rRendata.html" class="external-link">rRendata</a></code>.</p></dd>


<dt>threshold</dt>
<dd><p>The <em>main threshold</em> as commonly understood
in POT.</p></dd>


<dt>effDuration</dt>
<dd><p>The effective duration of the observation
period corresponding to the <code>data</code>.</p></dd>


<dt>MAX.data</dt>
<dd><p>A list of numeric vectors corresponding to periods
or <em>blocks</em>. Each vector contains the \(r\)-largest
observations for the block, where \(r&gt;0\) can vary across
blocks. When a numeric vector is passed instead of a list, it
is understood that there is only one MAX block.</p></dd>


<dt>MAX.effDuration</dt>
<dd><p>A vector of positive numbers giving the
durations of the MAX blocks (in the same order).</p></dd>


<dt>OTS.data</dt>
<dd><p>A list of numeric vectors corresponding to periods
or <em>blocks</em>. Each vector contains all observations for
the block which exceeded the corresponding threshold as given
in <code>OTS.threshold</code>. So the number \(r \geq 0\) vary
across blocks. When a numeric vector is passed instead of a
list, it is understood that there is only one OTS block.</p></dd>


<dt>OTS.threshold</dt>
<dd><p>A vector of positive numbers giving the
thresholds of the OTS blocks (in the same order). By
construction all the elements of <code>OTS.data[i]</code> are larger
than <code>OTS.threshold[i]</code> for each block index <code>i</code>.</p></dd>


<dt>OTS.effDuration</dt>
<dd><p>A vector of positive numbers giving the
durations of the OTS blocks (in the same order).</p></dd>


<dt>distName</dt>
<dd><p>Character name of the distribution to be used for
the excesses over the threshold. For now thids can be
<code>"GPD2"</code> corresponding to <code>GPD2</code>, or
<code>"exp1"</code> corresponding to <code>Exp1</code>. Note that
in all cases the first parameter is a (the) <em>scale
parameter</em>.</p></dd>


<dt>parIni</dt>
<dd><p>A named parameter vector. This will be used to set
the values if <code>estim</code> is <code>"none"</code> or to provide
initial values in the other cases. When <code>parIni</code> is
<code>NULL</code> the parameter vector stored in the object as will
contain <code>NA</code> when <code>estim</code> is <code>"none"</code> or "good"
initial values found by devoted function.</p></dd>


<dt>estim</dt>
<dd><p><code>Character</code> defining the function and the method
that will be used to maximise the likelhood. See <strong>Details</strong>.</p></dd>


<dt>coefLower, coefUpper</dt>
<dd><p>Named vectors of bounds for the
parameters. The values can be infinite <code>Inf</code> or
<code>-Inf</code>.  However, note that without bounds on the shape
parameter \(\xi\) the maximum likelihood is infinite and
obtained for \(\xi = -1\). Note also that the bounds are
ignored when <code>estim</code> is set to <code>"optim"</code>.</p></dd>


<dt>scale</dt>
<dd><p>Logical. If <code>TRUE</code> the observations in
<code>data</code>, <code>MAX.data</code> and <code>OTS.data</code> are all
divided by a common positive number in order to avoid
numerical problems. This number is returned as the
<code>scaleData</code> element of the returned list. Except from the
numerical problems, the value of the scale does not impact the
results such as the estimates of their covariance.</p></dd>


<dt>trace</dt>
<dd><p>Integer level of verbosity.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with among which the following objects are found</p>
<dl><dt>data</dt>
<dd>

<p>A copy of the data provided in <code>data</code> and the other
    formals <code>MAX.*</code> or <code>OTS.*</code></p></dd>

<dt>fitData</dt>
<dd>

<p>A modified version of <code>data</code> where the observations that
    do not exceed the main threshold \(u\) are discarded and
    each remaining observation \(y_i\) is replaced by the
    corresponding excess \(y_i - u\). So only positive
    observations are found in the data vectors.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The functions and methods used to maximise the likelihood depends
on <code>estim</code> as follows.</p>
<ul><li><p><code>estim = "optim"</code>
         The classical <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim</a></code> function is used with
         <code>method ="BFGS"</code>. The derivatives are not used and nor
         do the bounds on the parameters given in <code>coefLower</code> and
         <code>coefUpper</code>.</p></li>
<li><p><code>estim = "nloptr"</code>
        The <code><a href="https://rdrr.io/pkg/nloptr/man/nloptr.html" class="external-link">nloptr::nloptr</a></code> function is used with the
        <code>"NLOPT_LD_BFGS"</code> algorithm option. The derivatives
        are used as well as the bounds on the parameters, leading
        to "box constraints". The bounds can be used to fix the
        value of a GP parameter by using the same value in
        <code>coefLower</code> and <code>coefUpper</code>. For instance an
        exponential distribution can be fitted by using a zero
        value for the shape both in <code>coefLower</code> and
        <code>coefUpper</code>.</p></li>
<li><p><code>estim = "eval"</code>
        No optimisation is performed: the rate <code>lambda</code>
        corresponding to the provided GP parameters is computed
        and the negative log-likelihood and its first derivatives
        are evaluated, allowing the determination of a (putative)
        covariance matrix for the estimates. The named vector
        <code>parIni</code> should then contain values for the
        Poisson-GP parameters, and valid values for the GP
        parameters <code>"scale"</code> and <code>"shape"</code>. This
        possibility can be used to check the results provided by
        other packages, e.g. to recompute return levels. Note
        however that the provided parameters may not be
        approximately maximising the likelihood and the
        corresponding results will then be misleading.</p></li>
<li><p><code>estim = "none"</code>
        No optimisation is performed. The log-likelihood and
        negative log-likelihoods remain NA, and the initial values
        are ignored.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Yves Deville</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## =====================================================================</span></span></span>
<span class="r-in"><span><span class="co">## Use Garonne data from Renext</span></span></span>
<span class="r-in"><span><span class="co">## =====================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit1p</span> <span class="op">&lt;-</span> <span class="fu">poisGP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Flow</span>, threshold <span class="op">=</span> <span class="fl">2900</span>,</span></span>
<span class="r-in"><span>              effDuration <span class="op">=</span> <span class="fl">65</span>,</span></span>
<span class="r-in"><span>              MAX.data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">MAXdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>              MAX.effDuration <span class="op">=</span> <span class="fl">143</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit1R</span> <span class="op">&lt;-</span> <span class="fu">Renouv</span><span class="op">(</span><span class="va">Garonne</span>, threshold <span class="op">=</span> <span class="fl">2900</span>, distname.y <span class="op">=</span> <span class="st">"GPD"</span>,</span></span>
<span class="r-in"><span>                plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Renext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit1R</span><span class="op">)</span>, potomax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit1p</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Renext      potomax</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda    1.7257765    1.7260135</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale  1288.1036804 1287.2821401</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> shape    -0.1652691   -0.1650343</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## CAUTION when comparing log-likelihoods, see ?logLik.poisGP</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Renext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit1R</span><span class="op">)</span>, potomax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit1p</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Renext   potomax</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -925.9804 -925.9749</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## =====================================================================</span></span></span>
<span class="r-in"><span><span class="co">## Use the 'venice' data from the 'ismev' package. Contains</span></span></span>
<span class="r-in"><span><span class="co">## r-largest observations as a matrix with one row by year and NA.</span></span></span>
<span class="r-in"><span><span class="co">## So some transformations are needed. Note that first</span></span></span>
<span class="r-in"><span><span class="co">## of 'venice' must be removed, and that the 'venice' data from</span></span></span>
<span class="r-in"><span><span class="co">## the evd package may misleadingly be used instead.</span></span></span>
<span class="r-in"><span><span class="co">## =====================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">venice</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>object 'venice' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">venice</span>, package <span class="op">=</span> <span class="st">"ismev"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">MAX.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">venice</span><span class="op">[</span> , <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">MAX.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">MAX.data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">MAX.effDuration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">MAX.data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit2i</span> <span class="op">&lt;-</span> <span class="fu">ismev</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ismev/man/rlarg.fit.html" class="external-link">rlarg.fit</a></span><span class="op">(</span><span class="va">venice</span><span class="op">[</span> , <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $conv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $nllh</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1139.09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $mle</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 120.5479027  12.7840265  -0.1129418</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.36234055 0.54944881 0.01986948</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">fit2R</span> <span class="op">&lt;-</span> <span class="fu">Renext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Renext/man/fGEV.MAX.html" class="external-link">fGEV.MAX</a></span><span class="op">(</span>MAX.data <span class="op">=</span> <span class="va">MAX.data</span>,</span></span>
<span class="r-in"><span>                          MAX.effDuration <span class="op">=</span> <span class="va">MAX.effDuration</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2p</span> <span class="op">&lt;-</span> <span class="fu">poisGP</span><span class="op">(</span>MAX.data <span class="op">=</span> <span class="va">MAX.data</span>,</span></span>
<span class="r-in"><span>                MAX.effDuration <span class="op">=</span> <span class="va">MAX.effDuration</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>'threshold' is smaller than the smallest observation</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>'threshold' is smaller than the smallest observation</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To compare the coefficients we must use the "PP" coefficients</span></span></span>
<span class="r-in"><span><span class="co">## of the poisGP object rather than the standard "poisGP"</span></span></span>
<span class="r-in"><span><span class="co">## coefficients.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"ismev"</span> <span class="op">=</span> <span class="va">fit2i</span><span class="op">$</span><span class="va">mle</span>,</span></span>
<span class="r-in"><span>      <span class="st">"Renext"</span> <span class="op">=</span> <span class="va">fit2R</span><span class="op">$</span><span class="va">estimate</span>,</span></span>
<span class="r-in"><span>      <span class="st">"potomax"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit2p</span>, type <span class="op">=</span> <span class="st">"PP"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             ismev      Renext     potomax</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> loc   120.5479027 120.5452617 120.5459990</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale  12.7840265  12.7831983  12.7838900</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> shape  -0.1129418  -0.1129793  -0.1129545</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## CAUTION when comparing log-likelihoods, see ?logLik.poisGP</span></span></span>
<span class="r-in"><span><span class="co">## We choose here the "PP" type which usually makes the result</span></span></span>
<span class="r-in"><span><span class="co">## comparable to those based on block maxima or on r-largest.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"ismev"</span> <span class="op">=</span> <span class="op">-</span><span class="va">fit2i</span><span class="op">$</span><span class="va">nllh</span>,</span></span>
<span class="r-in"><span>       <span class="st">"Renext"</span> <span class="op">=</span> <span class="va">fit2R</span><span class="op">$</span><span class="va">loglik</span>,</span></span>
<span class="r-in"><span>       <span class="st">"potomax"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit2p</span>, type <span class="op">=</span> <span class="st">"PP"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ismev   Renext  potomax</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -1139.09 -1139.09 -1139.09</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## profile-likelihood confidence intervals on parameters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit2p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , 95%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             L      U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda 24.749 31.087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale  16.838 20.439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> shape  -0.133 -0.067</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">fit2p</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Venice r-largest"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="poisGP-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Now censor the MAX data. This can not be done with the</span></span></span>
<span class="r-in"><span><span class="co">## other packages </span></span></span>
<span class="r-in"><span><span class="va">fit3p</span> <span class="op">&lt;-</span> <span class="fu">poisGP</span><span class="op">(</span>MAX.data <span class="op">=</span> <span class="va">MAX.data</span>,</span></span>
<span class="r-in"><span>                MAX.effDuration <span class="op">=</span> <span class="va">MAX.effDuration</span>,</span></span>
<span class="r-in"><span>                threshold <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit3p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       lambda        scale        shape </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4.332673851 12.053243161  0.002246636 </span>
<span class="r-in"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">fit3p</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Venice r-largest with threshold 100 cm"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="poisGP-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##=====================================================================</span></span></span>
<span class="r-in"><span><span class="co">## Use Garonne data from Renext again case "shape = 0",</span></span></span>
<span class="r-in"><span><span class="co">##  (exponential / Gumbel) </span></span></span>
<span class="r-in"><span><span class="co">##=====================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fl">3001</span></span></span>
<span class="r-in"><span><span class="va">fit3p</span> <span class="op">&lt;-</span> <span class="fu">poisGP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>                threshold <span class="op">=</span> <span class="va">u</span>,</span></span>
<span class="r-in"><span>                effDuration <span class="op">=</span> <span class="fl">65</span>,</span></span>
<span class="r-in"><span>                MAX.data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">MAXdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>                MAX.effDuration <span class="op">=</span> <span class="fl">143</span>,</span></span>
<span class="r-in"><span>                distName <span class="op">=</span> <span class="st">"exp1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit3R</span> <span class="op">&lt;-</span> <span class="fu">Renouv</span><span class="op">(</span><span class="va">Garonne</span>, threshold <span class="op">=</span> <span class="va">u</span>, distname.y <span class="op">=</span> <span class="st">"exponential"</span>,</span></span>
<span class="r-in"><span>                plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## change parametrisation from Renext (rate -&gt; scale)</span></span></span>
<span class="r-in"><span><span class="co">## =================================================</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit3R</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">/</span> <span class="va">est</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda"</span>, <span class="st">"scale"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Renext <span class="op">=</span> <span class="va">est</span>, potomax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit3p</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Renext     potomax</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda    1.53889    1.538799</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale  1033.68946 1034.118803</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## compare log-likelihoods CAUTION see ?logLik.poisExp</span></span></span>
<span class="r-in"><span><span class="co">## ===================================================</span></span></span>
<span class="r-in"><span><span class="va">fit3pe</span> <span class="op">&lt;-</span> <span class="fu">poisGP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>                 threshold <span class="op">=</span> <span class="va">u</span>,</span></span>
<span class="r-in"><span>                 effDuration <span class="op">=</span> <span class="fl">65</span>,</span></span>
<span class="r-in"><span>                 parIni <span class="op">=</span> <span class="va">est</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                 MAX.data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">MAXdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>                 MAX.effDuration <span class="op">=</span> <span class="fl">143</span>,</span></span>
<span class="r-in"><span>                 distName <span class="op">=</span> <span class="st">"exp1"</span>,</span></span>
<span class="r-in"><span>                 estim <span class="op">=</span> <span class="st">"eval"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> No optimisation performed. Inference results can be misleading.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Renext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit3R</span><span class="op">)</span>, potomax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit3pe</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Renext   potomax</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -857.0064 -857.0001</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## use 'nloptr' optimisation</span></span></span>
<span class="r-in"><span><span class="co">## =========================</span></span></span>
<span class="r-in"><span><span class="va">fit3po</span> <span class="op">&lt;-</span> <span class="fu">poisGP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">OTdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>                 threshold <span class="op">=</span> <span class="va">u</span>,</span></span>
<span class="r-in"><span>                 effDuration <span class="op">=</span> <span class="fl">65</span>,</span></span>
<span class="r-in"><span>                 MAX.data <span class="op">=</span> <span class="va">Garonne</span><span class="op">$</span><span class="va">MAXdata</span><span class="op">$</span><span class="va">Flow</span>,</span></span>
<span class="r-in"><span>                 MAX.effDuration <span class="op">=</span> <span class="fl">143</span>,</span></span>
<span class="r-in"><span>                 distName <span class="op">=</span> <span class="st">"exp1"</span>,</span></span>
<span class="r-in"><span>                 estim <span class="op">=</span> <span class="st">"nloptr"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Return levels and inference</span></span></span>
<span class="r-in"><span><span class="co">## ===========================</span></span></span>
<span class="r-in"><span><span class="va">myRL</span> <span class="op">&lt;-</span> <span class="fu"><a href="RL.html">RL</a></span><span class="op">(</span><span class="va">fit1p</span>, trace <span class="op">=</span> <span class="fl">0</span>, conf <span class="op">=</span> <span class="st">"prof"</span>, check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use the 'autoplot' method on the resulting object to check the profile-likelihood results.</span>
<span class="r-in"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">myRL</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"prof. lik. inference on return levels"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 554 rows containing missing values (`geom_line()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 554 rows containing missing values (`geom_point()`).</span>
<span class="r-plt img"><img src="poisGP-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">autoplot</span><span class="op">(</span><span class="fu"><a href="RL.html">RL</a></span><span class="op">(</span><span class="va">fit1p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Return level plot (prof. lik. intervals)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="poisGP-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## confidence intervals on parameters</span></span></span>
<span class="r-in"><span><span class="co">## ==================================</span></span></span>
<span class="r-in"><span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit1p</span>, check <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"PP"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Use the 'autoplot' method on the result to check the results</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Since 'check' is TRUE, 'out' set to "data.frame"</span>
<span class="r-in"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">ci</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 15 rows containing missing values (`geom_line()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 15 rows containing missing values (`geom_point()`).</span>
<span class="r-plt img"><img src="poisGP-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Yves Deville.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

